% This is samplepaper.tex, a sample chapter demonstrating the
% LLNCS macro package for Springer Computer Science proceedings;
% Version 2.20 of 2017/10/04
%
\newif\ifnotanonymous \notanonymousfalse
\newif\iffullversion \fullversiontrue
\documentclass[runningheads]{llncs}
%
\usepackage{graphicx}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bcprules, proof}
\usepackage{fancybox}
\usepackage{mathtools}
\usepackage{float}
\usepackage{xparse}
\usepackage{lscape}
\usepackage{xspace}
\usepackage{url}

% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
% \renewcommand\UrlFont{\color{blue}\rmfamily}

\newcommand{\red}[1]{\textcolor{red}{#1 }}
\newcommand{\blue}[1]{\textcolor{blue}{#1 }}

\newcommand{\LTP}{$\lambda^{\triangleright\%}$\xspace}
\newcommand{\LMD}{$\lambda^{\textrm{MD}}$\xspace}
\newcommand{\LLF}{$\lambda\textrm{LF}$\xspace}

\newcommand{\G}{\Gamma}
\newcommand{\D}{\Delta}
\newcommand{\V}{\vdash_\Sigma}
\newcommand{\VT}{\vdash\hspace{-.50em}\raisebox{0.28em}{\tiny{$\TB$}}}
\newcommand{\iskind}{\text{\ kind}}
\newcommand{\TW}{{\mathop{\triangleright}}}
\newcommand{\TWL}{{\mathop{\triangleleft}}}
\newcommand{\F}{\forall}
\newcommand{\TB}{{\mathop{\blacktriangleright}}}
\newcommand{\TBL}{{\mathop{\blacktriangleleft}}}
\newcommand{\E}{\equiv}
\newcommand{\FV}{\text{FV}}
\newcommand{\FTV}{\text{FSV}}

\newcommand{\WStar}{\textsc{W-Star}}
\newcommand{\WAbs}{\textsc{W-Abs}}
\newcommand{\WCsp}{\textsc{W-Csp}}
\newcommand{\WApp}{\textsc{W-App}}
\newcommand{\WTW}{\textsc{W-$\TW$}}

\newcommand{\KVar}{\textsc{K-Var}}
\newcommand{\KTConst}{\textsc{K-TConst}}
\newcommand{\KAbs}{\textsc{K-Abs}}
\newcommand{\KApp}{\textsc{K-App}}
\newcommand{\KConv}{\textsc{K-Conv}}
\newcommand{\KTW}{\textsc{K-$\TW$}}
\newcommand{\KTWL}{\textsc{K-$\TWL$}}
\newcommand{\KGen}{\textsc{K-Gen}}
\newcommand{\KCsp}{\textsc{K-Csp}}

\newcommand{\TConst}{\textsc{T-Const}}
\newcommand{\TVar}{\textsc{T-Var}}
\newcommand{\TAbs}{\textsc{T-Abs}}
\newcommand{\TApp}{\textsc{T-App}}
\newcommand{\TConv}{\textsc{T-Conv}}
\newcommand{\TTB}{\textsc{T-$\TB$}}
\newcommand{\TTBL}{\textsc{T-$\TBL$}}
\newcommand{\TGen}{\textsc{T-Gen}}
\newcommand{\TIns}{\textsc{T-Ins}}
\newcommand{\TCsp}{\textsc{T-Csp}}

\newcommand{\QKAbs}{\textsc{QK-Abs}}
\newcommand{\QKCsp}{\textsc{QK-Csp}}
\newcommand{\QKRefl}{\textsc{QK-Refl}}
\newcommand{\QKSym}{\textsc{QK-Sym}}
\newcommand{\QKTrans}{\textsc{QK-Trans}}

\newcommand{\QTAbs}{\textsc{QT-Abs}}
\newcommand{\QTApp}{\textsc{QT-App}}
\newcommand{\QTTW}{\textsc{QT-$\TW$}}
\newcommand{\QTGen}{\textsc{QT-Gen}}
\newcommand{\QTCsp}{\textsc{QT-Csp}}
\newcommand{\QTRefl}{\textsc{QT-Refl}}
\newcommand{\QTSym}{\textsc{QT-Sym}}
\newcommand{\QTTrans}{\textsc{QT-Trans}}

\newcommand{\QAbs}{\textsc{Q-Abs}}
\newcommand{\QApp}{\textsc{Q-App}}
\newcommand{\QTB}{\textsc{Q-$\TB$}}
\newcommand{\QTBL}{\textsc{Q-$\TBL$}}
\newcommand{\QGen}{\textsc{Q-Gen}}
\newcommand{\QIns}{\textsc{Q-Ins}}
\newcommand{\QCsp}{\textsc{Q-Csp}}
\newcommand{\QRefl}{\textsc{Q-Refl}}
\newcommand{\QSym}{\textsc{Q-Sym}}
\newcommand{\QTrans}{\textsc{Q-Trans}}
\newcommand{\QBeta}{\textsc{Q-$\beta$}}
\newcommand{\QEta}{\textsc{Q-$\eta$}}
\newcommand{\QTBLTB}{\textsc{Q-$\TBL\TB$}}
\newcommand{\QLambda}{\textsc{Q-$\Lambda$}}
\newcommand{\QPercent}{\textsc{Q-\%}}

\newcommand{\ID}[1]{\infer[]{#1}{\vdots}}
\newcommand{\MD}[1]{\mathcal{D}_#1}

\newcommand{\I}{\textrm{Int}}
\newcommand{\B}{\textrm{Bool}}
\newcommand{\M}{\textrm{Mat}}

\newcommand{\rulefbox}[1]{\fbox{\ensuremath{#1}} \hspace{1mm}}

\newcommand{\AI}[1]{\textcolor{red}{[#1 -- AI]}}

\begin{document}
%
\title{A Dependently Typed Multi-Stage Calculus%
	\ifnotanonymous\thanks{Supported by organization x.}\fi
}
%
%\titlerunning{Abbreviated paper title}
% If the paper title is too long for the running head, you can set
% an abbreviated paper title here
%
\ifnotanonymous
	\author{Akira Kawata\inst{1} \and
		Atsushi Igarashi\inst{2}\orcidID{0000-0002-5143-9764}}
	% %
	\authorrunning{A. Kawata, A. Igarashi}
	% % First names are abbreviated in the running head.
	% % If there are more than two authors, 'et al.' is used.
	% %
	\institute{Graduate School of Informatics, Kyoto University, Kyoto, Japan\\
		\email{akira@fos.kuis.kyoto-u.ac.jp} \and
		\email{igarashi@kuis.kyoto-u.ac.jp}
	}
\fi
%
\maketitle              % typeset the header of the contribution
%
\begin{abstract}

	We study a dependently typed extension of a multi-stage programming
	language \`a la MetaOCaml, which supports quasi-quotation and
	cross-stage persistence for manipulation of code fragments as
	first-class values and eval for execution of programs dynamically
	generated by the code manipulation.  Dependent types are expected to
	bring to multi-stage programming enforcement of strong
	invariants---beyond simple type safety---on the behavior of
	dynamically generated code.  An extension is, however, not trivial
	because a type system would have to take stages---roughly speaking,
	the number of surrounding quotations---of types into account.
	
	To rigorously study properties of such an extension, we develop
	\LMD, which is an extension of Hanada and Igarashi's typed calculus
	\LTP with dependent types, and prove its properties including
	preservation, confluence, strong normalization for full
	reduction, and progress for staged reduction.  Motivated
	by code generators such that the type of generated code depends on a
	value from outside of quotations, we argue the significance of
	cross-stage persistence in dependently typed multi-stage programming
	and certain type equivalence that are not directly derived from
	reduction rules.
	
	% A multi-stage calculus enables us to generate and execute codes at runtime.
	% It can improve the performance of programs by generating optimized codes for given inputs.
	% Dependent types are types dependent on values. 
	% A vector with its length is a famous example of dependent types and it enables us to omit boundary checking.
	% In this paper, we design \LMD by introducing dependent type into $\lambda^{\TW\%}$.
	% You can make more efficient programs from existing dependent typed programs with \LMD.
	% \LMD has a simple, substitution-based full-reduction semantics and enjoys basic properties of subject reduction, confluence, and strong normalization, and progress.
	% It also includes an evaluation context which satisfies unique decomposition.
	% The main technical points of this paper are how to deal with Cross Stage Persistence of multi-stage calculuses which allows using a value in quoted code in a dependent type system.
	% Especially, the way of handling CSP in equivalence rules of dependent types wasn't clear.
	% In this paper, we give reasonable equivalence rules to handle them.
	
	\keywords{multi-stage programming, cross-stage persistence, dependent types}
\end{abstract}

\blue{181 words. The abstract should briefly summarize the contents of the paper in 150--250 words.}
\blue{コードとかはボールドを使ったほうが良いかもしれない。}
\red{Suspicious senetences are colored red.}
%
%
%
\red{Multi-stage Programming と Multi-stage Calculus をどう使い分けるか?}

\input{text/introduction.tex}

\input{text/informal-overview.tex}

\input{text/formal-defnition.tex}

\input{text/properties.tex}

\input{text/related-work.tex}

\input{text/conclusion.tex}

% \begin{enumerate}
% 	\item Done: On Cross-Stage Persistence in Multi-Stage\cite{Hanada2014}
	      
% 	      CSPも入りました
% 	\item Done: Eliminating Array Bound Checking Through Dependent Types\cite{Xi98}
% 	\item Done: MetaML and Multi-stage Programming with Explicit Annotations\cite{MetaML}
% 	\item Done: Idris, a general-purpose dependently typed programming language: Design and implementation\cite{brady2013idris}
% 	\item Done: A Logical Foundation for Environment Classifiers\cite{Tsukada}
% 	\item Done: Environment classifiers\cite{taha2003environment}
% 	\item Done: A framework for defining logics\cite{harper1993framework}
	      
% 	      $\Sigma$ の使い方を確認した
% 	\item Done: The Design and Implementation of {BER} MetaOCaml - System Description\cite{oleg2014}
% 	\item Done: Dependent types in practical programming\cite{xi1999dependent}
	      
% 	      Section of Applicationを読んだ。Dead Code EliminationやLoop Unrollingにも使えるらしい。
	      
% 	\item Done: A dependently typed assembly language\cite{xi2001dependently}
	      
% 	      DTALの定義と制約solverを用いた型検査の定義
% 	\item Done: Refined Environment Classifiers\cite{kiselyov2016refined}
% 	\item Done: Staging with control: type-safe multi-stage programming with control operators\cite{oishi2017staging}
% 	\item Done: Logical Modalities and Multi-Stage Programming\cite{benaissa1999logical}
% 	\item \red{Partial evaluation and automatic program generation}\cite{jones1993partial}
% 	\item \red{Efficient multi-level generating extensions for program specialization}\cite{gluck1995efficient}
% 	\item \red{Run-time code generation and Modal-ML}\cite{wickline1998run}
% 	\item \red{C and tcc: a language and compiler for dynamic code generation}\cite{poletto1999c}
% 	\item \red{Run-time bytecode specialization}\cite{masuhara2001run}
% 	\item \red{A tour of Tempo: A program specializer for the C language}\cite{consel2004tour}
% 	\item \red{Optimizing ML with run-time code generation}\cite{lee1996optimizing}
% 	\item \red{Efficient incremental run-time specialization for free}\cite{marlet1999efficient}
% \end{enumerate}

% 2つの設計手法と今回採用した理由
% Conclusion送りか?
% When we design type equivalence rules of \LMD, there are two design choices.
% One is defining type equivalence by $\beta$-equality after we define $\beta$-reduction of types.
% Another is defining type equivalence directly by a combination of type equivalence rules.
% We adopt the latter one because it is convenient to handle CSP in the type equivalence.

% \section{First Section}
% \subsection{A Subsection Sample}
% Please note that the first paragraph of a section or subsection is
% not indented. The first paragraph that follows a table, figure,
% equation etc. does not need an indent, either.
% 
% Subsequent paragraphs, however, are indented.
% 
% \subsubsection{Sample Heading (Third Level)} Only two levels of
% headings should be numbered. Lower level headings remain unnumbered;
% they are formatted as run-in headings.
% 
% \paragraph{Sample Heading (Fourth Level)}
% The contribution should contain no more than four levels of
% headings. Table~\ref{tab1} gives a summary of all heading levels.
% 
% \begin{table}
% \caption{Table captions should be placed above the
% tables.}\label{tab1}
% \begin{tabular}{|l|l|l|}
% \hline
% Heading level &  Example & Font size and style\\
% \hline
% Title (centered) &  {\Large\bfseries Lecture Notes} & 14 point, bold\\
% 1st-level heading &  {\large\bfseries 1 Introduction} & 12 point, bold\\
% 2nd-level heading & {\bfseries 2.1 Printing Area} & 10 point, bold\\
% 3rd-level heading & {\bfseries Run-in Heading in Bold.} Text follows & 10 point, bold\\
% 4th-level heading & {\itshape Lowest Level Heading.} Text follows & 10 point, italic\\
% \hline
% \end{tabular}
% \end{table}
% 
% 
% \noindent Displayed equations are centered and set on a separate
% line.
% \begin{equation}
% x + y = z
% \end{equation}
% Please try to avoid rasterized images for line-art diagrams and
% schemas. Whenever possible, use vector graphics instead (see
% Fig.~\ref{fig1}).
% 
% \begin{figure}
% \includegraphics[width=\textwidth]{fig1.eps}
% \caption{A figure caption is always placed below the illustration.
% Please note that short captions are centered, while long ones are
% justified by the macro package automatically.} \label{fig1}
% \end{figure}
% 
% \begin{theorem}
% This is a sample theorem. The run-in heading is set in bold, while
% the following text appears in italics. Definitions, lemmas,
% propositions, and corollaries are styled the same way.
% \end{theorem}
% %
% % the environments 'definition', 'lemma', 'proposition', 'corollary',
% % 'remark', and 'example' are defined in the LLNCS documentclass as well.
% %
% \begin{proof}
% Proofs, examples, and remarks have the initial word in italics,
% while the following text appears in normal font.
% \end{proof}
% For citations of references, we prefer the use of square brackets
% and consecutive numbers. Citations using labels or the author/year
% convention are also acceptable. The following bibliography provides
% a sample reference list with entries for journal
% articles~\cite{ref_article1}, an LNCS chapter~\cite{ref_lncs1}, a
% book~\cite{ref_book1}, proceedings without editors~\cite{ref_proc1},
% and a homepage~\cite{ref_url1}. Multiple citations are grouped
% \cite{ref_article1,ref_lncs1,ref_book1},
% \cite{ref_article1,ref_book1,ref_proc1,ref_url1}.
%
% ---- Bibliography ----
%
% BibTeX users should specify bibliography style 'splncs04'.
% References will then be sorted and formatted in the correct style.
%
\bibliographystyle{splncs04}
\bibliography{main}
%
% \begin{thebibliography}{8}
% \bibitem{ref_article1}
% Author, F.: Article title. Journal \textbf{2}(5), 99--110 (2016)
% 
% \bibitem{ref_lncs1}
% Author, F., Author, S.: Title of a proceedings paper. In: Editor,
% F., Editor, S. (eds.) CONFERENCE 2016, LNCS, vol. 9999, pp. 1--13.
% Springer, Heidelberg (2016). \doi{10.10007/1234567890}
% 
% \bibitem{ref_book1}
% Author, F., Author, S., Author, T.: Book title. 2nd edn. Publisher,
% Location (1999)
% 
% \bibitem{ref_proc1}
% Author, A.-B.: Contribution title. In: 9th International Proceedings
% on Proceedings, pp. 1--2. Publisher, Location (2010)
% 
% \bibitem{ref_url1}
% LNCS Homepage, \url{http://www.springer.com/lncs}. Last accessed 4
% Oct 2017
% \end{thebibliography}

\iffullversion
\appendix

%\newtheorem{thm}{Theorem}
\newtheorem{dfn}{Defnition}
\newtheorem{ex}{Example}
\newtheorem{cm}{Comment}
\newcommand{\figheader}[2]{
  \begin{flushleft}
    #2 {\bf \normalsize #1}
\end{flushleft}}

\newpage
\section{Full Definition of \LMD}
\input{text/fulldefinitions}

\section{Proofs}
\input{text/proofs}

\fi
\section{Appendix}

\blue{We solicit submissions in the form of regular research papers describing original scientific research results, including system development and case studies. Regular research papers should not exceed 18 pages in the Springer LNCS format, including bibliography and figures. This category encompasses both theoretical and implementation (also known as system descriptions) papers. In either case, submissions should clearly identify what has been accomplished and why it is significant. Submissions will be judged on the basis of significance, relevance, correctness, originality, and clarity. System descriptions papers should contain a link to a working system and will be judged on originality, usefulness, and design. In case of lack of space, proofs, experimental results, or any information supporting the technical results of the paper could be provided as an appendix or a link to a web page, but reviewers are not obliged to read them.}
\blue{Review Process
	APLAS 2019 will use a lightweight double-blind reviewing process. Following this process means that reviewers will not see the authors’ names or affiliations as they initially review a paper. The authors’ names will then be revealed to the reviewers only once their reviews have been submitted.
	To facilitate this process, submitted papers must adhere to the following:
	Author names and institutions must be omitted and
	References to the authors’ own related work should be in the third person (e.g., not “We build on our previous work …” but rather “We build on the work of …”).
	The purpose of this process is to help the reviewers come to an initial judgement about the paper without bias, not to make it impossible for them to discover the authors if they were to try. Nothing should be done in the name of anonymity that weakens the submission, makes the job of reviewing the paper more difficult, or interferes with the process of disseminating new ideas. For example, important background references should not be omitted or anonymized, even if they are written by the same authors and share common ideas, techniques, or infrastructure. Authors should feel free to disseminate their ideas or draft versions of their paper as they normally would. For instance, authors may post drafts of their papers on the web or give talks on their research ideas.}
\end{document}
